---
#
# Ansible managed
#
language: python

os: linux
dist: xenial

python:
  - "3.9"

services:
  - docker

env:
  global:
    namespace="robertdebock"
  jobs:
    - image="alpine" tag="latest"
    - image="amazonlinux" tag="1"
    - image="amazonlinux" tag="latest"
    - image="centos" tag="7"
    - image="centos" tag="latest"
    - image="debian" tag="latest"
    - image="debian" tag="bullseye"
    - image="fedora" tag="32"
    - image="fedora" tag="latest"
    - image="fedora" tag="rawhide"
    - image="opensuse" tag="latest"
    - image="ubuntu" tag="latest"
    - image="ubuntu" tag="bionic"
    - image="ubuntu" tag="xenial"

cache:
  - pip

install:
  - pip install --upgrade pip
  - pip install tox

script:
  - function retry { counter=0 ; until "$@" ; do exit=$? ; counter=$(($counter + 1)) ; if [ $counter -ge 3 ] ; then return $exit ; fi ; done ; return 0; } ; retry tox

notifications:
  webhooks: https://galaxy.ansible.com/api/v1/notifications/
  slack:
    secure: "Qbjhl1QUVpT8wUjsPPa9djCQ+8Jazy/FrwDy1VF2JRTmy1dgoCc8sliBMPN6e0w4bAVg92T7ACiJe6mmjTvjWHQWfwuwcF2WyEQDbzsTD2IKjpCVIyQ1eDmomoVG9VVa3fUwu2M+W0zHOFlKEY/gOPZnLWboFoaYFyrWEP3ps1o4RFi5xTR8CG3oDApsX7mn6ts4HfQ6n6eE4XR7Mf/Z+8k1IbR2QxqsdYvDJdzXzF4ulv18Gccj8spWNzKKtwBB1GlUdCtLFRmFmsAxowwainS425/ZEg0DokME1QNdKj2U5WNH2eSEvv0ld4OdBaoTueW5TyhcBonl1p21Oya0fY2YTXvdlDxeUl404NXzAgMYfNzPFrzptYH7mH4LtkPHYEY6C/Ns7VK2LUZmWGgjBXH4Av2kxgaBW94AeBi6iNCfL94Dum7kN32mdZ8Aow76Xmb8hdn7AGoW+gFgZ6uewFjodRMr0+W9lAKvCiH1n5t3SAGPQ0sU5acG5EIylJL8gcSb8OmQCRjnFMJsfEgnbK/SxE5k/+/dlhE3xp7T1isixCsE0dv2QfUW2BDTFxon688nW3Gr3OuUwfqbsrXqx9GZruep23/8+o3RC0h6gaJHwCiDGgku06fiFMZHnvrek4MSqtVZFyqbHTU+mfXvhOfPwG8POTidh9xIW4T6UNY="
    on_success: change
    template: "%{result}: %{repository_slug}@%{branch}, build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>)"
  email: false
